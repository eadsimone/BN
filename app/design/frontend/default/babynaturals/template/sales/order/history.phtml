<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2011 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php $_columnCount =$this->getColumnCount(); ?>
<?php echo $this->getMessagesBlock()->getGroupedHtml() ?>
<?php $_orders = $this->getOrders(); ?>


<div class="page-title">
    <h1><?php echo $this->__('ORDER HISTORY') ?></h1>
</div>

<?php //echo $this->getPagerHtml(); ?>
<?php if($_orders->getSize()): ?>

    
      
    
        <?php $_odd = ''; ?>
		<?php  $i=0; ?>
		<?php //echo '<pre>'; print_r($_orders); ?>
        <?php foreach ($_orders as $_order): ?>
		  <div class="order-history <?php echo ($i%2)?'last':'first';?>">
		  <ul>
		  
            <li class="order-id"><?php echo $this->__('Order #') ?><?php echo $_order->getRealOrderId() ?></li>
            <li><span class="order-subtitle"><?php echo $this->__('Ordered on') ?>:</span><?php echo $this->formatDate($_order->getCreatedAtStoreDate()) ?></li>
			<?php $shipments = Mage::getResourceModel('sales/order_shipment_grid_collection')->getData();
//echo $_order->getEntityId();
foreach($shipments as $shipment){
	//echo $shipment['entity_id'];
	if($_order->getIncrementId() == $shipment['order_increment_id']){
		$originalDate = $shipment['created_at'];		
		
	$newDate = date("d/m/Y", strtotime($originalDate));
	echo $newDate;
	}
} ?>
            <li><span class="order-subtitle"><?php echo $this->__('Shipped on') ?>:</span><?php echo $newDate; ?></li>
			
			<li><span class="order-subtitle"><?php echo $this->__('Shipped To') ?>:</span><?php echo $_order->getShippingAddress()->format('html') ?></li>
            <?php /*<li><span class="nobr"><?php echo $this->__('Order Total') ?>:<?php echo $_order->formatPrice($_order->getGrandTotal()) ?></span></li>
            <li><span class="nobr"><?php echo $this->__('Order Status') ?></span>:<em><?php echo $_order->getStatusLabel() ?></em></li>*/?>
            <li><span class="order-subtitle"><?php echo $this->__('Order Details') ?>:</span>
			
			<?php
			$qtyStock = $_order->getTotalQtyOrdered()*1;
			
			
			$order_items = $_order->getAllItems();
foreach($order_items as $item) {
$qty = $item->getQtyOrdered()*1; 
    $product = Mage::getModel('catalog/product')->load($item->getProductId());
    //and you can do what ever you want with the product
echo $product->getName();
echo "&nbsp;(".$qty.")<br/>";
//echo $product->ordered_qty;
} ?> 

<?php 
echo $_order->formatPrice($_order->getGrandTotal()) ;
echo "paid by " . $_order->getPayment()->getMethodInstance()->getTitle();
?>
<?php //echo $_order->getPayment_auth_expiration(); ?>
<?php //echo $this->getPaymentInfoHtml() ?>


			 </li>
             
        </ul>
		</div>
		<?php if(($i%2) != 0){ ?>
		<div class="clear"></div>
		<?php } ?>

        <?php /*<ul>
            <li class="a-center">
                <span class="nobr"><a href="<?php echo $this->getViewUrl($_order) ?>"><?php echo $this->__('View Order') ?></a>
                    <span class="separator">|</span><a href="<?php echo $this->getTrackUrl($_order) ?>"><?php echo $this->__('Track Order') ?></a>&nbsp;
                    <?php if ($this->helper('sales/reorder')->canReorder($_order)) : ?>
                    <span class="separator">|</span> <a href="<?php echo $this->getReorderUrl($_order) ?>" class="link-reorder"><?php echo $this->__('Reorder') ?></a>
                <?php endif ?>
                </span>
            </li>
        </ul> */
		$i++;
		?>
	
        
        <?php endforeach; ?>
		
<script type="text/javascript">decorateTable('my-orders-table');</script>
<?php //echo $this->getPagerHtml(); ?>
<?php else: ?>
    <p><?php echo $this->__('You have placed no orders.'); ?></p>
<?php endif ?>
